def help_command(bot, update):
    user_id = update.effective_user.id
    logger.info(f"❓ /help викликано користувачем: {user_id}")
    
    try:
        if user_id == ADMIN_USER_ID:
            help_message = (
                "🤖 ДОВІДКА ДЛЯ АДМІНІСТРАТОРА\n\n"
                "👥 КОРИСТУВАЦЬКІ КОМАНДИ:\n"
                "🚪 /hvirtka - Відкрити хвіртку\n"
                "🏠 /vorota - Відкрити ворота\n"
                "📞 /call - Телефон лікаря Вікторії\n"
                "🗺️ /map - Карта розташування\n"
                "📋 /scheme - Схема проходу в ЖК\n"
                "🧪 /test - Тест роботи бота\n"
                "📊 /status - Статус користувача\n\n"
                "👑 АДМІНІСТРАТИВНІ КОМАНДИ:\n"
                "📈 /stats - Загальна статистика дзвінків\n"
                "📊 /stats_detail - Детальна статистика\n"
                "🔄 /sync - Ручна синхронізація клієнтів\n"
                "🔄 /restart - Перезапуск бота\n"
                "❓ /help - Ця довідка\n\n"
                "📱 КОНТАКТИ ПІДТРИМКИ:\n"
                "+380733103110"
            )
        elif is_authenticated(user_id):
            help_message = (
                "🤖 ДОВІДКА ПО КОМАНДАХ\n\n"
                "🔓 ДОСТУПНІ ДІЇ:\n"
                "🚪 /hvirtka - Відкрити хвіртку для проходу\n"
                "🏠 /vorota - Відкрити ворота для авто\n"
                "📞 /call - Зателефонувати лікарю Вікторії\n"
                "🗺️ /map - Подивитись розташування на мапі\n"
                "📋 /scheme - Схема розташування в ЖК Графський\n\n"
                "ℹ️ ІНФОРМАЦІЙНІ:\n"
                "🧪 /test - Перевірити роботу бота\n"
                "📊 /status - Ваш статус в системі\n"
                "❓ /help - Ця довідка\n\n"
                "💡 ПІДКАЗКИ:\n"
                "• Використовуйте меню для швидкого доступу\n"
                "• При проблемах з відкриттям спробуйте ще раз\n"
                "• Для підтримки дзвоніть: +380733103110"
            )
        else:
            help_message = (
                "🤖 ДОВІДКА\n\n"
                "❌ Ви не авторизовані в системі\n\n"
                "📱 Для авторизації:\n"
                "1. Натисніть /start\n"
                "2. Поділіться номером телефону\n"
                "3. Дочекайтеся підтвердження доступу\n\n"
                "🔓 ДОСТУПНІ КОМАНДИ:\n"
                "📞 /call - Зателефонувати лікарю\n"

# Знаходимо рядок з функцією help_command
line_num=$(grep -n "def help_command" bot.py | cut -d: -f1)

# Створюємо патч файл
cat > help_patch.py << 'EOF'
def help_command(bot, update):
    user_id = update.effective_user.id
    logger.info(f"❓ /help викликано користувачем: {user_id}")
    
    try:
        if user_id == ADMIN_USER_ID:
            help_message = (
                "🤖 ДОВІДКА ДЛЯ АДМІНІСТРАТОРА\n\n"
                "👥 КОРИСТУВАЦЬКІ КОМАНДИ:\n"
                "🚪 /hvirtka - Відкрити хвіртку\n"
                "🏠 /vorota - Відкрити ворота\n"
                "📞 /call - Телефон лікаря Вікторії\n"
                "🗺️ /map - Карта розташування\n"
                "📋 /scheme - Схема проходу в ЖК\n"
                "🧪 /test - Тест роботи бота\n"
                "📊 /status - Статус користувача\n\n"
                "👑 АДМІНІСТРАТИВНІ КОМАНДИ:\n"
                "📈 /stats - Загальна статистика дзвінків\n"
                "📊 /stats_detail - Детальна статистика\n"
                "🔄 /sync - Ручна синхронізація клієнтів\n"
                "🔄 /restart - Перезапуск бота\n"
                "❓ /help - Ця довідка\n\n"
                "📱 КОНТАКТИ ПІДТРИМКИ:\n"
                "+380733103110"
            )
        elif is_authenticated(user_id):
            help_message = (
                "🤖 ДОВІДКА ПО КОМАНДАХ\n\n"
                "🔓 ДОСТУПНІ ДІЇ:\n"
                "🚪 /hvirtka - Відкрити хвіртку для проходу\n"
                "🏠 /vorota - Відкрити ворота для авто\n"
                "📞 /call - Зателефонувати лікарю Вікторії\n"
                "🗺️ /map - Подивитись розташування на мапі\n"
                "📋 /scheme - Схема розташування в ЖК Графський\n\n"
                "ℹ️ ІНФОРМАЦІЙНІ:\n"
                "🧪 /test - Перевірити роботу бота\n"
                "📊 /status - Ваш статус в системі\n"
                "❓ /help - Ця довідка\n\n"
                "💡 ПІДКАЗКИ:\n"
                "• Використовуйте меню для швидкого доступу\n"
                "• При проблемах з відкриттям спробуйте ще раз\n"
                "• Для підтримки дзвоніть: +380733103110"
            )
        else:
            help_message = (
                "🤖 ДОВІДКА\n\n"
                "❌ Ви не авторизовані в системі\n\n"
                "📱 Для авторизації:\n"
                "1. Натисніть /start\n"
                "2. Поділіться номером телефону\n"
                "3. Дочекайтеся підтвердження доступу\n\n"
                "🔓 ДОСТУПНІ КОМАНДИ:\n"
                "📞 /call - Зателефонувати лікарю\n"
                "🗺️ /map - Подивитись розташування\n"
                "📋 /scheme - Схема проходу\n"
                "❓ /help - Ця довідка\n\n"
                "📞 ДЛЯ РЕЄСТРАЦІЇ ЗВЕРНІТЬСЯ:\n"
                "+380733103110\n"
                "Instagram: @dr.gomon"
            )
        
        bot.send_message(
            chat_id=update.message.chat_id,
            text=help_message
        )
        logger.info(f"❓ Довідка відправлена користувачу {user_id}")
        
    except Exception as e:
        logger.exception(f"❌ Помилка в help_command: {e}")
        bot.send_message(
            chat_id=update.message.chat_id,
            text="🤖 ДОВІДКА\n\nОсновні команди:\n/hvirtka - Відкрити хвіртку\n/vorota - Відкрити ворота\n/call - Телефон лікаря\n/map - Карта\n/scheme - Схема\n\nТехпідтримка: +380733103110"
        )

