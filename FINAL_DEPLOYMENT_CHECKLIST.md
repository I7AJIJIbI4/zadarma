# ‚úÖ –§–Ü–ù–ê–õ–¨–ù–ò–ô –ß–ï–ö–õ–Ü–°–¢ –†–û–ó–ì–û–†–¢–ê–ù–ù–Ø

## üéØ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ –ì–∞—Ä–∞–Ω—Ç—ñ—ó –°–∏—Å—Ç–µ–º–∏

### ‚úÖ **–ö—Ä–∏—Ç–∏—á–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω—ñ:**
- **–£–°–ü–Ü–•**: `duration > 0 + cancel = "‚úÖ –í—ñ–¥—á–∏–Ω–µ–Ω–æ!"`
- **–ó–ê–ô–ù–Ø–¢–û**: `busy = "‚ùå –ù–æ–º–µ—Ä –∑–∞–π–Ω—è—Ç–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑."`
- **–ù–ï –í–Ü–î–ü–û–í–Ü–î–ê–Ñ**: `duration = 0 = "‚ùå –ù–æ–º–µ—Ä –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î."`
- **–ü–û–ú–ò–õ–ö–ê**: `—ñ–Ω—à—ñ —Å—Ç–∞—Ç—É—Å–∏ = "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏. –°—Ç–∞—Ç—É—Å: [status]"`

### ‚úÖ **–†–æ—É—Ç–∏–Ω–≥ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–∏–π:**
- **BOT CALLBACK**: `FROM: 0733103110 ‚Üí TO: –ø—Ä–∏—Å—Ç—Ä—ñ–π` = Python processor
- **IVR –î–ó–í–Ü–ù–û–ö**: `FROM: –∑–æ–≤–Ω—ñ—à–Ω—ñ–π ‚Üí TO: –±—É–¥—å-—è–∫–∏–π` = PHP handler

### ‚úÖ **Telegram –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:**
- –ù–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è **–¢–Ü–õ–¨–ö–ò** –¥–ª—è bot callbacks
- –ù–µ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –¥–ª—è IVR –¥–∑–≤—ñ–Ω–∫—ñ–≤
- –ú—ñ—Å—Ç—è—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ñ —Å—Ç–∞—Ç—É—Å–∏ –¥–ª—è –≤—Å—ñ—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤

---

## üöÄ –ö—Ä–æ–∫–∏ –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### 1. **Backup –ü–æ—Ç–æ—á–Ω–æ—ó –°–∏—Å—Ç–µ–º–∏**
```bash
ssh gomoncli@uashared35.ukraine.com.ua
cd /home/gomoncli/zadarma

# –°—Ç–≤–æ—Ä—ñ—Ç—å backup –≤—Å—ñ—Ö –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤
cp simple_webhook.py simple_webhook_backup_$(date +%Y%m%d_%H%M%S).py
cp process_webhook.py process_webhook_backup_$(date +%Y%m%d_%H%M%S).py
cp /home/gomoncli/public_html/zadarma_webhook.php /home/gomoncli/public_html/zadarma_webhook_backup_$(date +%Y%m%d_%H%M%S).php
```

### 2. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –§–∞–π–ª—ñ–≤**
–ó–∞–º—ñ–Ω—ñ—Ç—å **–ü–û–í–ù–ò–ô –≤–º—ñ—Å—Ç** —Ñ–∞–π–ª—ñ–≤ –Ω–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ –≤–µ—Ä—Å—ñ—ó:

- [ ] **`simple_webhook.py`** ‚Üê –ê—Ä—Ç–µ—Ñ–∞–∫—Ç `simple_webhook_enhanced`
- [ ] **`process_webhook.py`** ‚Üê –ê—Ä—Ç–µ—Ñ–∞–∫—Ç `process_webhook_fixed`  
- [ ] **`/home/gomoncli/public_html/zadarma_webhook.php`** ‚Üê –ê—Ä—Ç–µ—Ñ–∞–∫—Ç `zadarma_webhook_fixed`

### 3. **–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –ü—Ä–∞–≤ –î–æ—Å—Ç—É–ø—É**
```bash
chmod +x simple_webhook.py
chmod +x process_webhook.py
chmod 755 /home/gomoncli/public_html/zadarma_webhook.php
```

---

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ü—ñ—Å–ª—è –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è

### **–¢–µ—Å—Ç 1: Python –õ–æ–≥—ñ–∫–∞**
```bash
cd /home/gomoncli/zadarma

# –£—Å–ø—ñ—Ö (duration > 0)
python3 simple_webhook.py '{"event":"NOTIFY_END","caller_id":"0733103110","called_did":"0637442017","disposition":"cancel","duration":"5"}'
# –û—á—ñ–∫—É—î—Ç—å—Å—è: ‚úÖ –•–≤—ñ—Ä—Ç–∫–∞ –≤—ñ–¥—á–∏–Ω–µ–Ω–æ!

# –ó–∞–π–Ω—è—Ç–æ
python3 simple_webhook.py '{"event":"NOTIFY_END","caller_id":"0733103110","called_did":"0930063585","disposition":"busy","duration":"0"}'
# –û—á—ñ–∫—É—î—Ç—å—Å—è: ‚ùå –ù–æ–º–µ—Ä –≤–æ—Ä–æ—Ç–∞ –∑–∞–π–Ω—è—Ç–∏–π

# –ù–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î  
python3 simple_webhook.py '{"event":"NOTIFY_END","caller_id":"0733103110","called_did":"0637442017","disposition":"cancel","duration":"0"}'
# –û—á—ñ–∫—É—î—Ç—å—Å—è: ‚ùå –ù–æ–º–µ—Ä —Ö–≤—ñ—Ä—Ç–∫–∞ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î
```

### **–¢–µ—Å—Ç 2: PHP Webhook**
```bash
# Bot Callback
curl -X POST https://gomonclinic.com/zadarma_webhook.php \
  -d "event=NOTIFY_END&caller_id=0733103110&called_did=0637442017&disposition=cancel&duration=5"
# –û—á—ñ–∫—É—î—Ç—å—Å—è: {"status":"bot_processed","result":"...‚úÖ –•–≤—ñ—Ä—Ç–∫–∞ –≤—ñ–¥—á–∏–Ω–µ–Ω–æ!..."}

# IVR –î–∑–≤—ñ–Ω–æ–∫
curl -X POST https://gomonclinic.com/zadarma_webhook.php \
  -d "event=NOTIFY_START&caller_id=0501234567&called_did=0733103110"
# –û—á—ñ–∫—É—î—Ç—å—Å—è: {"ivr_say":{"text":"–î–æ–±—Ä–æ–≥–æ –¥–Ω—è!...","language":"ua"}...}
```

### **–¢–µ—Å—Ç 3: –†–µ–∞–ª—å–Ω—ñ –ö–æ–º–∞–Ω–¥–∏ –ë–æ—Ç–∞**
1. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ Telegram –±–æ—Ç**
2. **–ù–∞–¥—ñ—à–ª—ñ—Ç—å `/hvirtka`**
   - –û—á—ñ–∫—É—î—Ç—å—Å—è: "üîë –ü—ñ–¥–±–∏—Ä–∞—î–º–æ –∫–ª—é—á—ñ‚Ä¶" ‚Üí "–í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ö–≤—ñ—Ä—Ç–∫–∏ —ñ–Ω—ñ—Ü—ñ–π–æ–≤–∞–Ω–æ..."
   - –ß–µ—Ä–µ–∑ ~10 —Å–µ–∫: **"‚úÖ –•–≤—ñ—Ä—Ç–∫–∞ –≤—ñ–¥—á–∏–Ω–µ–Ω–æ!"**

3. **–ù–∞–¥—ñ—à–ª—ñ—Ç—å `/vorota`**
   - –û—á—ñ–∫—É—î—Ç—å—Å—è: "üö™ –ü—ñ–¥–±–∏—Ä–∞—î–º–æ –∫–ª—é—á—ñ‚Ä¶" ‚Üí "–í—ñ–¥–∫—Ä–∏—Ç—Ç—è –≤–æ—Ä—ñ—Ç —ñ–Ω—ñ—Ü—ñ–π–æ–≤–∞–Ω–æ..."
   - –ß–µ—Ä–µ–∑ ~10 —Å–µ–∫: **"‚úÖ –í–æ—Ä–æ—Ç–∞ –≤—ñ–¥—á–∏–Ω–µ–Ω–æ!"**

---

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –õ–æ–≥—ñ–≤

### **PHP –õ–æ–≥–∏:**
```bash
tail -f /home/gomoncli/public_html/error_log | grep -E "(ROUTING|Bot callback|IVR)"
```

### **Python –õ–æ–≥–∏:**
```bash
tail -f /tmp/webhook_processor.log
```

### **–ë–∞–∑–∞ –î–∞–Ω–∏—Ö:**
```bash
sqlite3 /home/gomoncli/zadarma/call_tracking.db "SELECT call_id, action_type, target_number, status, created_at FROM call_tracking ORDER BY created_at DESC LIMIT 5;"
```

---

## üö® Troubleshooting

### ‚ùå **–Ø–∫—â–æ Telegram –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏:**
   ```bash
   tail -20 /home/gomoncli/public_html/error_log
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —î –∑–∞–ø–∏—Å–∏ –≤ –±–∞–∑—ñ:**
   ```bash
   sqlite3 call_tracking.db "SELECT * FROM call_tracking WHERE status='api_success' ORDER BY created_at DESC LIMIT 3;"
   ```

3. **–¢–µ—Å—Ç Python —Å–∫—Ä–∏–ø—Ç–∞ –æ–∫—Ä–µ–º–æ:**
   ```bash
   python3 simple_webhook.py '{"event":"NOTIFY_END","caller_id":"0733103110","called_did":"0637442017","disposition":"cancel","duration":"5"}'
   ```

### ‚ùå **–Ø–∫—â–æ IVR –Ω–µ –ø—Ä–∞—Ü—é—î:**

1. **–¢–µ—Å—Ç IVR —á–µ—Ä–µ–∑ cURL:**
   ```bash
   curl -X POST https://gomonclinic.com/zadarma_webhook.php \
     -d "event=NOTIFY_START&caller_id=0501234567&called_did=0733103110"
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ —Ä–æ—É—Ç–∏–Ω–≥—É:**
   ```bash
   grep "ROUTING" /home/gomoncli/public_html/error_log
   ```

### ‚ùå **–Ø–∫—â–æ Python –ø–æ–º–∏–ª–∫–∏:**

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ syntax:**
   ```bash
   python3 -m py_compile simple_webhook.py
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤–µ—Ä—Å—ñ—é:**
   ```bash
   python3 --version  # –ú–∞—î –±—É—Ç–∏ 3.6+
   ```

---

## üéØ –û—á—ñ–∫—É–≤–∞–Ω—ñ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

### ‚úÖ **–î–û —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è (–ø–æ–ª–∞–º–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞):**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ: `/hvirtka` ‚Üí "‚ùå –ù–æ–º–µ—Ä –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î" (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ: `/vorota` ‚Üí "‚ùå –ù–æ–º–µ—Ä –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î" (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ) 
- IVR: –ú–æ–∂–ª–∏–≤—ñ –∑–±–æ—ó —á–µ—Ä–µ–∑ —Å–ø—ñ–ª—å–Ω–∏–π –∫–æ–¥

### ‚úÖ **–ü–Ü–°–õ–Ø —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è (–≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞):**
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ: `/hvirtka` ‚Üí "‚úÖ –•–≤—ñ—Ä—Ç–∫–∞ –≤—ñ–¥—á–∏–Ω–µ–Ω–æ!" (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ: `/vorota` ‚Üí "‚úÖ –í–æ—Ä–æ—Ç–∞ –≤—ñ–¥—á–∏–Ω–µ–Ω–æ!" (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- –ü—Ä–∏ –∑–∞–π–Ω—è—Ç–æ—Å—Ç—ñ: "‚ùå –ù–æ–º–µ—Ä –∑–∞–π–Ω—è—Ç–∏–π. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑."
- –ü—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –∑–≤'—è–∑–∫—É: "‚ùå –ù–æ–º–µ—Ä –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î."
- IVR: –ü—Ä–∞—Ü—é—î –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –±–µ–∑ –∑–±–æ—ó–≤

---

## üìã –§—ñ–Ω–∞–ª—å–Ω–∏–π –ß–µ–∫–ª—ñ—Å—Ç

- [ ] **Backup —Å—Ç–≤–æ—Ä–µ–Ω–æ** ‚úì
- [ ] **simple_webhook.py –æ–Ω–æ–≤–ª–µ–Ω–æ** 
- [ ] **process_webhook.py –æ–Ω–æ–≤–ª–µ–Ω–æ**
- [ ] **zadarma_webhook.php –æ–Ω–æ–≤–ª–µ–Ω–æ**
- [ ] **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ**
- [ ] **Python —Ç–µ—Å—Ç–∏ –ø—Ä–æ–π—à–ª–∏**
- [ ] **PHP webhook —Ç–µ—Å—Ç–∏ –ø—Ä–æ–π—à–ª–∏**
- [ ] **IVR —Ç–µ—Å—Ç–∏ –ø—Ä–æ–π—à–ª–∏**
- [ ] **–ö–æ–º–∞–Ω–¥–∞ /hvirtka –ø—Ä–∞—Ü—é—î**
- [ ] **–ö–æ–º–∞–Ω–¥–∞ /vorota –ø—Ä–∞—Ü—é—î**
- [ ] **–õ–æ–≥–∏ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ**
- [ ] **–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∞**

---

## üéâ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –£—Å–ø—ñ—Ö—É

### **100% SUCCESS –∫—Ä–∏—Ç–µ—Ä—ñ—ó:**

1. **–ö–æ–º–∞–Ω–¥–∞ `/hvirtka`:**
   - –ü–æ—á–∞—Ç–∫–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: "üîë –ü—ñ–¥–±–∏—Ä–∞—î–º–æ –∫–ª—é—á—ñ‚Ä¶"
   - –ü—Ä–æ—Ü–µ—Å: "–í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Ö–≤—ñ—Ä—Ç–∫–∏ —ñ–Ω—ñ—Ü—ñ–π–æ–≤–∞–Ω–æ..."
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç: "‚úÖ –•–≤—ñ—Ä—Ç–∫–∞ –≤—ñ–¥—á–∏–Ω–µ–Ω–æ!"**

2. **–ö–æ–º–∞–Ω–¥–∞ `/vorota`:**
   - –ü–æ—á–∞—Ç–∫–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: "üö™ –ü—ñ–¥–±–∏—Ä–∞—î–º–æ –∫–ª—é—á—ñ‚Ä¶" 
   - –ü—Ä–æ—Ü–µ—Å: "–í—ñ–¥–∫—Ä–∏—Ç—Ç—è –≤–æ—Ä—ñ—Ç —ñ–Ω—ñ—Ü—ñ–π–æ–≤–∞–Ω–æ..."
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç: "‚úÖ –í–æ—Ä–æ—Ç–∞ –≤—ñ–¥—á–∏–Ω–µ–Ω–æ!"**

3. **IVR —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª:**
   - –ó–æ–≤–Ω—ñ—à–Ω—ñ –¥–∑–≤—ñ–Ω–∫–∏ ‚Üí PHP IVR menu
   - –í–∏–±—ñ—Ä 1/2 ‚Üí –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
   - –ù–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ bot callbacks

4. **–ü–æ–º–∏–ª–∫–∏ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è:**
   - –ó–∞–π–Ω—è—Ç–æ ‚Üí "‚ùå –ù–æ–º–µ—Ä –∑–∞–π–Ω—è—Ç–∏–π"
   - –ù–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î ‚Üí "‚ùå –ù–æ–º–µ—Ä –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î"
   - –Ü–Ω—à—ñ –ø–æ–º–∏–ª–∫–∏ ‚Üí "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–∫—Ä–∏—Ç–∏"

### **–Ø–∫—â–æ –í–°–ï –ø—Ä–∞—Ü—é—î:**
üéä **–°–ò–°–¢–ï–ú–ê –ü–û–í–ù–Ü–°–¢–Æ –í–ò–ü–†–ê–í–õ–ï–ù–ê!** üéä

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –Ω–∞—Ä–µ—à—Ç—ñ –æ—Ç—Ä–∏–º–∞—é—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å –ø–æ–º–∏–ª–∫–æ–≤–∏—Ö "–Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î", —ñ IVR –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ —è–∫ —ñ —Ä–∞–Ω—ñ—à–µ.

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ –¥–ª—è –ü—ñ–¥—Ç—Ä–∏–º–∫–∏

**–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∑–±–µ—Ä–µ–∂—ñ—Ç—å:**
- –°–∫—Ä—ñ–Ω—à–æ—Ç–∏ –ø–æ–º–∏–ª–æ–∫
- –í–∏–≤–æ–¥–∏ –∫–æ–º–∞–Ω–¥ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è  
- –õ–æ–≥–∏ –∑ error_log
- –°—Ç–∞–Ω –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

**–¢–æ–¥—ñ –º–æ–∂–Ω–∞ –±—É–¥–µ —à–≤–∏–¥–∫–æ –¥—ñ–∞–≥–Ω–æ—Å—Ç—É–≤–∞—Ç–∏ —Ç–∞ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏.**
